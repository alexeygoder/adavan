import os

# 1. Identify all .svo2 files in the input directory
SAMPLES, = glob_wildcards("step1_input/{sample}.svo2")

rule all:
    input:
        expand("uploaded_successfully/{sample}.mp4", sample=SAMPLES)

# Step 1: Process SVO to MP4
rule process_svo:
    input:
        "step1_input/{sample}.svo2"
    output:
        # Snakemake needs the specific file path here to track completion
        "step1_output/{sample}.mp4"
    threads: 2
    shell:
        """
        python adavan/run_pipeline1.py \
        {input} \
        step1_output
        """

# Step 2: AWS Upload and Move
rule upload_to_aws:
    input:
        "step1_output/{sample}.mp4"
    output:
        "uploaded_successfully/{sample}.mp4"
    threads: 1
    shell:
        # Your script takes the file path, uploads it, and moves it to the target folder
        "./to_aws.sh {input}"